<!DOCTYPE html>

<html>
<head>
  <title>Learning Machines - Interactive tutorials to learn machine learning</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" type="text/css" href="css/main.css">
</head>

<body>
    <h1>Learning Machines</h1>

    <p>Interactive tutorials on machine learning.</p>
    
    <svg class="plot"></svg>

    <button type="button" onclick="clusterData()">Cluster</button>

    <p>
        The above lets you test out a K-Means Classifier. Click to
        add new data points and hit 'Classify' to run the classifier.
    </p>
</body>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

<script>
    function drawCircle(x, y, size) {
        var plot = d3.select('svg');
        plot.append("circle")
            .attr('class', 'click-circle')
            .attr('cx', x)
            .attr('cy', y)
            .attr('r', size);
    }

    function colourClusters(clusters) {
        var plot = d3.select('svg');
        var i = 0;
        plot.selectAll("circle").selectAll(function() {
            d3.select(this).attr('class',
                clusters[i] == 0 ? 'red-circle' : 'blue-circle');
            i += 1;
        });
    }

    function getCoords() {
        var plot = d3.select('svg');
        let coords = [];
        plot.selectAll("circle").selectAll(function() {
            coords.push([
                parseFloat(d3.select(this).attr('cx')),
                parseFloat(d3.select(this).attr('cy'))
            ]);
        });

        return coords;
    }

    function clusterData() {
        var coords = getCoords();
        var body = JSON.stringify({ data: coords });

        d3.request('/models/kmeans')
            .post(body, (err, resp) => {
                var json_resp = JSON.parse(resp['responseText']);
                console.log(json_resp);
                colourClusters(json_resp);
            });

    }

    (function() {
        var plot = d3.select('svg');
        
        plot.on('click', function() {
            var coords = d3.mouse(this);
            drawCircle(coords[0], coords[1], 5);
        });
        
    })();
</script>
